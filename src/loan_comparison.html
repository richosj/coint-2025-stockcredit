<!-- @pageTitle 대출비교 -->
<!-- @pageNote 대출비교 절차 & 상품비교 -->
<!-- @pageCreated 2025-11-28 -->
<!-- @pageUpdated 2025-11-28 -->
<!DOCTYPE html>
<html lang="ko">

<head>
	{{> layout/meta}}
</head>

<body>
	{{> layout/header}}
	<main id="main" class="main">
		{{> layout/subVisual}}

		<div class="breadcrumb">
			<div class="container">
				<ol class="breadcrumb-list">
					<li class="breadcrumb-item">
						<a href="/">홈</a>
					</li>
					<li class="breadcrumb-item">
						<a href="/loan">대출비교서비스</a>
					</li>
					<li class="breadcrumb-item">
						<span>증권사담보대출비교-대고객</span>
					</li>
				</ol>
			</div>
		</div>

		<div id="sub-layout">
			<div class="container">
				<div class="loan-comparison-page">
					<!-- 대출비교 절차 섹션 -->
					<div class="procedure-section">
						<h2 class="procedure-title">대출비교 절차</h2>
						<div class="procedure-steps">
							<img src="/images/loan/loan_comparison_procedure.png" alt="대출비교 절차">
						</div>
						<div class="procedure-notes">
							<p class="procedure-note">종목의 평가금액은 전일 종가기준으로 계산됩니다.</p>
							<p class="procedure-note">실제 대출 가능 금액은 증권사 심사 결과에 따라 변동될 수 있습니다.</p>
						</div>
					</div>

					<!-- 보유종목 섹션 -->
					<div class="stocks-section">
						<div class="section-header">
							<h3 class="section-title">
								<span class="icon"><img src="/images/loan/ico-stock.png" alt="보유종목"></span>
								보유종목 (Max 10 items)
							</h3>
							<div class="section-buttons login-before-section">
								<button class="btn-add">추가 <i class="ico-plus"><img src="/images/loan/ico-plus.png" alt="추가"></i></button>
								<button class="btn-close-list">목록 닫기 <i class="ico-close"><img src="/images/loan/ico-close.png" alt="목록 닫기"></i></button>
							</div>
						</div>
						<p class="stocks-instruction">주식수는 신용/담보대출 포함 종목별 총 합계 주식수를 입력하세요.</p>
						<div class="stock-list" id="stock-list">
							<div class="stock-item">
								<div class="stock-item-header">
									<div class="stock-checkbox">
										<input type="checkbox" class="stock-checkbox-input" id="stock-checkbox-1">
									</div>
									<div class="stock-info">
										<div class="stock-name">ACE 삼성그룹섹터가중</div>
										<div class="stock-price">109,900원</div>
									</div>
								</div>
								<div class="stock-item-footer">
									<div class="stock-quantity">
										<input type="text" class="quantity-input" value="5" min="1" title="주식 수량" placeholder="수량" readonly>
										<div class="quantity-controls">
											<button class="quantity-btn up" type="button" aria-label="수량 증가"></button>
											<button class="quantity-btn down" type="button" aria-label="수량 감소"></button>
										</div>
									</div>
									<span class="quantity-unit">주</span>
									<span class="quantity-value">109,900원</span>
									<button class="stock-remove" type="button" aria-label="종목 삭제">×</button>
								</div>
							</div>
							<!-- /stock-item -->
						</div>
						<div class="login-after-buttons">
							<button class="btn-add" id="btn-add-stock" data-modal="stockModal">추가 <i class="ico-plus"><img src="/images/loan/ico-plus.png" alt="추가"></i></button>
						</div>
						<div class="total-amount">
							<span class="total-label">총 평가금액 :</span>
							<span class="total-value" id="total-amount">277,180원</span>
						</div>
						<button class="btn-compare" id="btn-compare" type="button">상품 비교하기</button>
					</div>

					<!-- 상품 비교 결과 섹션 -->
					<div class="results-section" id="results-section">
						<div class="filter-group">
							<div class="filter-item">
								<div class="filter-label">사용기간</div>
								<div class="filter-buttons">
									<button class="filter-btn" type="button">30일</button>
									<button class="filter-btn active" type="button">90일</button>
									<button class="filter-btn" type="button">180일</button>
								</div>
							</div>
							<div class="filter-item">
								<div class="filter-label">정렬순</div>
								<div class="filter-buttons">
									<button class="filter-btn" type="button">금리</button>
									<button class="filter-btn" type="button">금액</button>
									<button class="filter-btn active" type="button">담보</button>
								</div>
							</div>
						</div>
						<div class="results-status">
							2개 증권사 중 1상품이 검색 되었습니다. (실패 : 1, 판매중단 : 0)
						</div>
						<table class="results-table">
							<thead>
								<tr>
									<th>증권사</th>
									<th>금리(%)</th>
									<th>금액(만)(LTV)</th>
									<th>담보(%)</th>
									<th></th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>DB증권</td>
									<td>8.59</td>
									<td>6,180 (56)</td>
									<td style="color: #df0000;">140</td>
									<td><button class="btn-select" type="button">선택</button></td>
								</tr>
								<tr>
									<td>하나증권</td>
									<td>8.59</td>
									<td>6,180 (56)</td>
									<td style="color: #df0000;">140</td>
									<td><button class="btn-select" type="button">선택</button></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>

	</main>

	{{> layout/footer}}

	<!-- 종목 등록 모달 -->
	<div class="modal" id="stockModal">
		<div class="modal-content">
			<button class="modal-close">&times;</button>
			<h2 class="modal-title">종목 등록</h2>
			<div class="modal-body-wrapper">
				<div class="modal-body">
					<div class="modal-search">
						<label for="stock-search" class="sr-only">종목 검색</label>
						<input type="text" class="modal-search-input" placeholder="종목명 종목코드 입력" id="stock-search" title="종목명 종목코드 입력">
						<span class="modal-search-icon" aria-label="검색">
							<img src="/images/loan/search.png" alt="검색">
						</span>
					</div>
					<div class="modal-stock-list" id="modal-stock-list">
						<div class="modal-stock-item">
							<span class="modal-stock-name">ACE 삼성그룹동일가중</span>
							<button class="modal-stock-add" type="button">+</button>
						</div>
						<div class="modal-stock-item">
							<span class="modal-stock-name">삼성전자</span>
							<span class="modal-stock-registered">등록됨</span>
						</div>
						<div class="modal-stock-item">
							<span class="modal-stock-name">ACE 삼성그룹동일가중</span>
							<button class="modal-stock-add" type="button">+</button>
						</div>
						<div class="modal-stock-item">
							<span class="modal-stock-name">ACE 삼성그룹동일가중</span>
							<button class="modal-stock-add" type="button">+</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script type="module" src="/js/main.js"></script>
	<script>
		// quantity-value만 업데이트 (수량 * 단가)
		function updateQuantityValue(stockItem) {
			const stockPrice = stockItem.querySelector('.stock-price');
			const quantityInput = stockItem.querySelector('.quantity-input');
			const quantityValue = stockItem.querySelector('.quantity-value');
			
			if (!stockPrice || !quantityInput || !quantityValue) return;
			
			const price = parseInt(stockPrice.textContent.replace(/[^0-9]/g, '')) || 0;
			const quantity = parseInt(quantityInput.value) || 0;
			const total = price * quantity;
			
			quantityValue.textContent = total.toLocaleString() + '원';
		}

		// 모달 열기/닫기는 main.js에서 자동 처리됨
		document.addEventListener('DOMContentLoaded', function() {

			// 수량 조절 버튼
			const quantityBtns = document.querySelectorAll('.quantity-btn');
			quantityBtns.forEach(btn => {
				btn.addEventListener('click', function() {
					const stockItem = this.closest('.stock-item');
					const input = stockItem?.querySelector('.quantity-input');
					if (!input) return;
					
					const isUp = this.classList.contains('up');
					const currentValue = parseInt(input.value) || 0;
					const newValue = isUp ? currentValue + 1 : Math.max(1, currentValue - 1);
					input.value = newValue;
					
					// readonly 속성 제거하여 값 변경 가능하게
					input.removeAttribute('readonly');
					
					// quantity-value만 업데이트
					updateQuantityValue(stockItem);
				});
			});

			// 수량 입력 변경
			const quantityInputs = document.querySelectorAll('.quantity-input');
			quantityInputs.forEach(input => {
				const stockItem = input.closest('.stock-item');
				
				input.addEventListener('input', function() {
					if (parseInt(this.value) < 1) {
						this.value = 1;
					}
					// quantity-value만 업데이트
					if (stockItem) {
						updateQuantityValue(stockItem);
					}
				});
				
				input.addEventListener('change', function() {
					if (parseInt(this.value) < 1) {
						this.value = 1;
					}
					// quantity-value만 업데이트
					if (stockItem) {
						updateQuantityValue(stockItem);
					}
				});
			});

			// 종목 삭제
			document.querySelectorAll('.stock-remove').forEach(btn => {
				btn.addEventListener('click', function() {
					this.closest('.stock-item')?.remove();
				});
			});

			// 모달에서 종목 추가
			document.querySelectorAll('.modal-stock-add').forEach(btn => {
				btn.addEventListener('click', function() {
					const stockItem = this.closest('.modal-stock-item');
					const stockName = stockItem?.querySelector('.modal-stock-name')?.textContent;
					
					if (!stockName) return;
					
					// 종목 추가 로직
					const stockList = document.getElementById('stock-list');
					if (stockList) {
						const newStockItem = document.createElement('div');
						newStockItem.className = 'stock-item';
						newStockItem.innerHTML = `
							<div class="stock-item-header">
								<div class="stock-checkbox">
									<input type="checkbox" class="stock-checkbox-input" id="stock-checkbox-${Date.now()}">
								</div>
								<div class="stock-info">
									<div class="stock-name">${stockName}</div>
									<div class="stock-price">0원</div>
								</div>
							</div>
							<div class="stock-item-footer">
								<div class="stock-quantity">
									<input type="text" class="quantity-input" value="1" min="1" title="주식 수량" placeholder="수량">
									<div class="quantity-controls">
										<button class="quantity-btn up" type="button" aria-label="수량 증가"></button>
										<button class="quantity-btn down" type="button" aria-label="수량 감소"></button>
									</div>
								</div>
								<span class="quantity-unit">주</span>
								<span class="quantity-value">0원</span>
								<button class="stock-remove" type="button" aria-label="종목 삭제">×</button>
							</div>
						`;
						
						stockList.appendChild(newStockItem);
						
						// 새로 추가된 요소에 이벤트 리스너 추가
						const newQuantityBtns = newStockItem.querySelectorAll('.quantity-btn');
						newQuantityBtns.forEach(newBtn => {
							newBtn.addEventListener('click', function() {
								const stockItem = this.closest('.stock-item');
								const input = stockItem?.querySelector('.quantity-input');
								if (!input) return;
								
								const isUp = this.classList.contains('up');
								const currentValue = parseInt(input.value) || 0;
								const newValue = isUp ? currentValue + 1 : Math.max(1, currentValue - 1);
								input.value = newValue;
								
								// quantity-value만 업데이트
								updateQuantityValue(stockItem);
							});
						});
						
						const newInput = newStockItem.querySelector('.quantity-input');
						if (newInput) {
							newInput.addEventListener('input', function() {
								if (parseInt(this.value) < 1) {
									this.value = 1;
								}
								// quantity-value만 업데이트
								updateQuantityValue(newStockItem);
							});
							newInput.addEventListener('change', function() {
								if (parseInt(this.value) < 1) {
									this.value = 1;
								}
								// quantity-value만 업데이트
								updateQuantityValue(newStockItem);
							});
						}
						
						const newRemoveBtn = newStockItem.querySelector('.stock-remove');
						if (newRemoveBtn) {
							newRemoveBtn.addEventListener('click', function() {
								this.closest('.stock-item')?.remove();
							});
						}
						
						// 초기 가격 설정
						updateStockPrice(newStockItem);
					}
					
					// 모달 닫기 (기존 시스템 사용)
					const stockModal = document.getElementById('stockModal');
					if (stockModal) {
						stockModal.classList.remove('active');
						document.body.style.overflow = 'auto';
					}
				});
			});

			// 필터 버튼
			document.querySelectorAll('.filter-btn').forEach(btn => {
				btn.addEventListener('click', function() {
					const group = this.closest('.filter-item');
					if (group) {
						group.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
						this.classList.add('active');
					}
				});
			});

			// 상품 비교하기 버튼
			const btnCompare = document.getElementById('btn-compare');
			if (btnCompare) {
				btnCompare.addEventListener('click', function() {
					const resultsSection = document.getElementById('results-section');
					if (resultsSection) {
						resultsSection.scrollIntoView({ behavior: 'smooth' });
					}
				});
			}

			// 초기 quantity-value 설정
			document.querySelectorAll('.stock-item').forEach(item => {
				updateQuantityValue(item);
			});
		});
	</script>
	<style>
		.sr-only {
			position: absolute;
			width: 1px;
			height: 1px;
			padding: 0;
			margin: -1px;
			overflow: hidden;
			clip: rect(0, 0, 0, 0);
			white-space: nowrap;
			border-width: 0;
		}
	</style>
</body>

</html>

