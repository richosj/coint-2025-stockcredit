<!-- @pageTitle 1:1 문의 목록 -->
<!-- @pageNote 팝업추가-->
<!-- @pageCreated 2025-11-26 -->
<!-- @pageUpdated 2025-12-14 -->
<!DOCTYPE html>
<html lang="ko">

<head>
	{{> layout/meta}}
</head>

<body>
	{{> layout/header}}
	<main id="main" class="main">
		{{> layout/subVisual}}

		<div class="breadcrumb">
			<div class="container">
				<ol class="breadcrumb-list">
					<li class="breadcrumb-item">
						<a href="/">고객센터</a>
					</li>
					<li class="breadcrumb-item">
						<span>1:1 문의</span>
					</li>
				</ol>
			</div>
		</div>

		<div id="sub-layout">
			<div class="container">
				<div class="d-flex align-baseline">
					<h2 class="sub-title mr-md">1:1 문의
						<span class="error-message">회원으로 가입하시면 1:1 문의가 가능합니다.</span>
					</h2>
				</div>
				<div class="table-container">
					<table class="table">
						<colgroup>
							<col style="width: 10%;">
							<col style="width: 70%;">
							<col style="width: 20%;">
						</colgroup>
						<thead>
							<tr>
								<th>순번</th>
								<th>제목</th>
								<th>등록일</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>1</td>
								<td class="text-left"><a href="#" data-modal="qnaViewModal">스탁크레딧에서 알려드립니다.</a></td>
								<td>5/30/2025</td>
							</tr>
							<tr>
								<td colspan="3">
									<div class="col-nodata">등록된 게시물이 없습니다.</div>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div class="pagination-container">
					{{> components/paging}}
				</div>

				<div class="btn-write">
					<button type="button" class="btn" data-modal="qnaModal">문의하기</button>
				</div>

			</div>
		</div>

	</main>

	{{> layout/footer}}

	<!-- 1:1 문의 모달 -->
	<div class="modal" id="qnaModal">
		<div class="modal-content">
			<button class="modal-close">&times;</button>
			<h2 class="modal-title">1:1 문의</h2>
			<div class="modal-body-wrapper">
				<div class="modal-body">
					<form id="qna-form" class="qna-form">
						<div class="form-group">
							<input type="text" class="input" id="qna-title" placeholder="제목" required>
							<div class="error-message" style="display: none;"></div>
						</div>
						<div class="form-group">
							<input type="text" class="input" id="qna-name" placeholder="이름" value="홍길동" readonly required>
							<div class="error-message" style="display: none;"></div>
						</div>
						<div class="form-group">
							<textarea class="textarea" id="qna-content" placeholder="내용" rows="8" required></textarea>
							<div class="error-message" style="display: none;"></div>
						</div>
						<div class="form-group">
							<div class="captcha-section">
								<label class="captcha-label">내용등록방지</label>
								<div class="captcha-wrapper">
									<div class="captcha-image-wrapper">
										<canvas id="captcha-canvas" width="120" height="40" style="cursor: pointer;" title="클릭하여 새로고침"></canvas>
									</div>
									<div class="captcha-input-wrapper">
										<input type="text" class="input" id="captcha-input" placeholder="보안문자를 입력해주세요." required>
										<button type="button" class="captcha-refresh" id="captcha-refresh" aria-label="새로고침">
											<img src="/images/captcha-refresh.png" alt="새로고침">
										</button>
									</div>
								</div>
								<div class="error-message" style="display: none;"></div>
							</div>
						</div>
						<div class="form-group">
							<button type="submit" class="btn btn-submit">작성</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

	<!-- 1:1 문의 읽기 전용 모달 -->
	<div class="modal" id="qnaViewModal">
		<div class="modal-content">
			<button class="modal-close">&times;</button>
			<h2 class="modal-title">&nbsp;</h2>
			<div class="modal-body-wrapper">
				<div class="modal-body">
					<div class="qna-view-form">
						<div class="form-group">
							<input type="text" class="input" id="view-qna-title" value="이글은 테스트입니다." readonly>
						</div>
						<div class="form-group form-group--inline">
							<input type="text" class="input" id="view-qna-name" value="홍길동" readonly>
							<input type="text" class="input" id="view-qna-date" value="12-11-2025" readonly>
						</div>
						<div class="form-group">
							<textarea class="textarea" id="view-qna-content" rows="8" readonly>이글은 테스트용도의 글쓰기입니다.</textarea>
						</div>
						<div class="form-group">
							<button type="button" class="btn btn-delete">삭제</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script type="module" src="/js/main.js"></script>
	<script>
		document.addEventListener('DOMContentLoaded', function() {
			const qnaForm = document.getElementById('qna-form');
			const qnaTitle = document.getElementById('qna-title');
			const qnaName = document.getElementById('qna-name');
			const qnaContent = document.getElementById('qna-content');
			const captchaInput = document.getElementById('captcha-input');
			const captchaCanvas = document.getElementById('captcha-canvas');
			const captchaRefresh = document.getElementById('captcha-refresh');
			const qnaModal = document.getElementById('qnaModal');
			
			let captchaCode = '';

			// 에러 메시지 표시 함수
			function showError(input, message) {
				let errorDiv;
				// 캡차 입력의 경우 captcha-section에서 찾기
				if (input.id === 'captcha-input') {
					errorDiv = input.closest('.captcha-section').querySelector('.error-message');
				} else {
					errorDiv = input.parentElement.querySelector('.error-message');
				}
				
				if (!errorDiv) {
					errorDiv = document.createElement('div');
					errorDiv.className = 'error-message';
					if (input.id === 'captcha-input') {
						input.closest('.captcha-section').appendChild(errorDiv);
					} else {
						input.parentElement.appendChild(errorDiv);
					}
				}
				errorDiv.textContent = message;
				errorDiv.style.display = 'block';
				input.style.borderColor = '#df0000';
			}

			// 에러 메시지 숨기기
			function hideError(input) {
				let errorDiv;
				// 캡차 입력의 경우 captcha-section에서 찾기
				if (input.id === 'captcha-input') {
					errorDiv = input.closest('.captcha-section').querySelector('.error-message');
				} else {
					errorDiv = input.parentElement.querySelector('.error-message');
				}
				
				if (errorDiv) {
					errorDiv.style.display = 'none';
				}
				input.style.borderColor = '';
			}

			// 캡차 생성 함수
			function generateCaptcha() {
				const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
				captchaCode = '';
				for (let i = 0; i < 6; i++) {
					captchaCode += chars.charAt(Math.floor(Math.random() * chars.length));
				}

				const ctx = captchaCanvas.getContext('2d');
				ctx.clearRect(0, 0, captchaCanvas.width, captchaCanvas.height);
				
				// 배경색
				ctx.fillStyle = '#fff';
				ctx.fillRect(0, 0, captchaCanvas.width, captchaCanvas.height);
				
				// 노이즈 점 추가
				for (let i = 0; i < 50; i++) {
					ctx.fillStyle = `rgba(${Math.random() * 100}, ${Math.random() * 100}, 200, 0.3)`;
					ctx.beginPath();
					ctx.arc(Math.random() * captchaCanvas.width, Math.random() * captchaCanvas.height, 2, 0, Math.PI * 2);
					ctx.fill();
				}
				
				// 텍스트 그리기
				ctx.font = 'bold 20px Arial';
				ctx.fillStyle = '#0066cc';
				ctx.textAlign = 'center';
				ctx.textBaseline = 'middle';
				
				// 각 문자를 약간 회전시키고 위치 조정
				for (let i = 0; i < captchaCode.length; i++) {
					ctx.save();
					ctx.translate(20 + i * 16, 20);
					ctx.rotate((Math.random() - 0.5) * 0.3);
					ctx.fillText(captchaCode[i], 0, 0);
					ctx.restore();
				}
			}

			// 캡차 새로고침
			if (captchaRefresh) {
				captchaRefresh.addEventListener('click', function() {
					generateCaptcha();
					captchaInput.value = '';
					hideError(captchaInput);
				});
			}

			// 캡차 이미지 클릭 시 새로고침
			if (captchaCanvas) {
				captchaCanvas.addEventListener('click', function() {
					generateCaptcha();
					captchaInput.value = '';
					hideError(captchaInput);
				});
			}

			// 모달이 열릴 때 캡차 생성
			if (qnaModal) {
				const observer = new MutationObserver(function(mutations) {
					mutations.forEach(function(mutation) {
						if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
							if (qnaModal.classList.contains('active')) {
								generateCaptcha();
								// 폼 초기화
								qnaForm.reset();
								qnaName.value = '홍길동';
								captchaInput.value = '';
								// 모든 에러 메시지 숨기기
								document.querySelectorAll('#qna-form .error-message').forEach(function(el) {
									el.style.display = 'none';
								});
								document.querySelectorAll('#qna-form .input, #qna-form .textarea').forEach(function(el) {
									el.style.borderColor = '';
								});
							}
						}
					});
				});
				observer.observe(qnaModal, { attributes: true });
			}

			// 실시간 유효성 검사
			if (qnaTitle) {
				qnaTitle.addEventListener('blur', function() {
					if (!this.value.trim()) {
						showError(this, '제목을 입력해주세요.');
					} else if (this.value.trim().length < 1) {
						showError(this, '제목은 1자 이상 입력해주세요.');
					} else {
						hideError(this);
					}
				});
			}

			if (qnaName) {
				qnaName.addEventListener('blur', function() {
					if (!this.value.trim()) {
						showError(this, '이름을 입력해주세요.');
					} else if (this.value.trim().length < 1) {
						showError(this, '이름은 1자 이상 입력해주세요.');
					} else {
						hideError(this);
					}
				});
			}

			if (qnaContent) {
				qnaContent.addEventListener('blur', function() {
					if (!this.value.trim()) {
						showError(this, '내용을 입력해주세요.');
					} else if (this.value.trim().length < 1) {
						showError(this, '내용은 1자 이상 입력해주세요.');
					} else {
						hideError(this);
					}
				});
			}

			if (captchaInput) {
				captchaInput.addEventListener('blur', function() {
					if (!this.value.trim()) {
						showError(this, '보안문자를 입력해주세요.');
					} else if (this.value.trim().toLowerCase() !== captchaCode.toLowerCase()) {
						showError(this, '보안문자가 일치하지 않습니다.');
					} else {
						hideError(this);
					}
				});
			}

			// 폼 제출 검증
			if (qnaForm) {
				qnaForm.addEventListener('submit', function(e) {
					e.preventDefault();

					let isValid = true;

					// 제목 검증
					if (!qnaTitle || !qnaTitle.value.trim()) {
						if (qnaTitle) showError(qnaTitle, '제목을 입력해주세요.');
						isValid = false;
					} else if (qnaTitle.value.trim().length < 1) {
						showError(qnaTitle, '제목은 1자 이상 입력해주세요.');
						isValid = false;
					} else {
						hideError(qnaTitle);
					}

					// 이름 검증
					if (!qnaName || !qnaName.value.trim()) {
						if (qnaName) showError(qnaName, '이름을 입력해주세요.');
						isValid = false;
					} else if (qnaName.value.trim().length < 1) {
						showError(qnaName, '이름은 1자 이상 입력해주세요.');
						isValid = false;
					} else {
						hideError(qnaName);
					}

					// 내용 검증
					if (!qnaContent || !qnaContent.value.trim()) {
						if (qnaContent) showError(qnaContent, '내용을 입력해주세요.');
						isValid = false;
					} else if (qnaContent.value.trim().length < 1) {
						showError(qnaContent, '내용은 1자 이상 입력해주세요.');
						isValid = false;
					} else {
						hideError(qnaContent);
					}

					// 캡차 검증
					if (!captchaInput || !captchaInput.value.trim()) {
						if (captchaInput) showError(captchaInput, '보안문자를 입력해주세요.');
						isValid = false;
					} else if (captchaInput.value.trim().toLowerCase() !== captchaCode.toLowerCase()) {
						showError(captchaInput, '보안문자가 일치하지 않습니다.');
						isValid = false;
					} else {
						hideError(captchaInput);
					}

					if (isValid) {
						// 폼 제출 성공
						alert('문의가 성공적으로 등록되었습니다.');
						qnaModal.classList.remove('active');
						document.body.style.overflow = 'auto';
						qnaForm.reset();
						qnaName.value = '홍길동';
						captchaInput.value = '';
						generateCaptcha();
					} else {
						// 첫 번째 에러 필드로 스크롤
						const firstError = document.querySelector('#qna-form .error-message[style*="block"]');
						if (firstError) {
							const input = firstError.parentElement.querySelector('.input, .textarea');
							if (input) {
								input.scrollIntoView({ behavior: 'smooth', block: 'center' });
								input.focus();
							}
						}
					}
				});
			}
		});
	</script>
</body>

</html>